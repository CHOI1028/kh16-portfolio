<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>회원 가입</title>
    <link rel="stylesheet" type="text/css" href="./commons.css">
    <link rel="stylesheet" type="text/css"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css">

    <style>

    </style>

    <!-- jquery cdn -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <!-- 카카오 우편 API CDN -->
    <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
    <!-- momentjs CDN-->
    <script src=https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.30.1/locale/ko.min.js></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.30.1/moment.min.js"></script>
    <!-- lightpick cdn -->
    <link href="https://cdn.jsdelivr.net/npm/lightpick@1.6.2/css/lightpick.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/lightpick@1.6.2/lightpick.min.js"></script>


    <script type="text/javascript">
        //회원 가입 입력화면에 대한 처리
        $(function () {
            //상태 객체
            var state = {
                memberIdValid: false,
                memberPwValid: false,
                memberPwCheckValid: false,
                memberNicknameValid: false,
                memberEmailValid: false,
                memberContactValid: true,
                memberBirthValid: true,
                memberAddressValid: true,
                ok: function () {
                    return this.memberIdValid && this.memberPwValid && this.memberPwCheckValid
                        && this.memberNicknameValid && this.memberEmailValid;
                }
            };
            //아이디 관련
            $("[name=memberId]").on("blur", function () {
                //[1] 형식 검사를 먼저 수행
                var regex = /^[a-z][a-z0-9]{7,19}$/;
                var valid = regex.test($(this).val());
                if (valid == false) {//형식이 올바르지 않다면
                    $(this).removeClass("success fail fail2").addClass("fail");
                    state.memberIdValid = false;
                    return;
                }

                //[2] 형식 검사를 통과했다면...
                //var memberId = $(this).val();
                var memberId = $("[name=memberId]").val();
                $.ajax({
                    url: "http://localhost:8080/rest/member/checkMemberId?memberId=" + memberId,
                    success: function (response) {
                        //서버의 검사 결과에 따른 처리
                        //- 서버가 아이디가 사용중이라고 하면 fail2를 추가
                        //- 서버가 아이디가 사용중이 아니라고 하면 success를 추가
                        //console.log(response);
                        if (response == true) {//아이디가 서버에 이미 존재하는 경우
                            $("[name=memberId]").removeClass("success fail fail2").addClass("fail2");
                            state.memberIdValid = false;
                        }
                        else {//아이디가 서버에 존재하지 않는 경우
                            $("[name=memberId]").removeClass("success fail fail2").addClass("success");
                            state.memberIdValid = true;
                        }
                    }
                });

            });

            //비밀번호 관련
            $("[name=memberPw] , #password-check").on("blur", function () {
                //this를 특정할 수 없음(둘 중 하나)
                //[1] 모든 클래스제거
                $("[name=memberPw] , #password-check").removeClass("success fail");

                //[2] 비밀번호 형식검사
                var regex = /^(?=.*?[A-Z]+)(?=.*?[a-z]+)(?=.*?[0-9]+)(?=.*?[!@#$]+)[A-Za-z0-9!@#$]{8,16}$/;
                var valid = regex.test($("[name=memberPw]").val());
                $("[name=memberPw]").addClass(valid ? "success" : "fail");
                state.memberPwValid = valid;
                //[3] 비밀번호 일치 검사 (비밀번호가 입력된 경우에만 수행)
                if ($("[name=memberPw]").val().length > 0) {
                    var valid2 = $("[name=memberPw]").val() == $("#password-check").val();
                    $("#password-check").addClass(valid2 ? "success" : "fail");
                    state.memberPwCheckValid = valid2;
                }
            });
            $("#password-show").on("click", function () {
                if ($(this).hasClass("fa-eye-slash")) {//type=password 상태라면
                    $(this).removeClass("fa-eye-slash").addClass("fa-eye");
                    $("[name=memberPw], #password-check").prop("type", "text");
                }
                else {//type=text 상태라면
                    $(this).removeClass("fa-eye").addClass("fa-eye-slash");
                    $("[name=memberPw], #password-check").prop("type", "password");
                }
            });

            //닉네임 관련
            $("[name=memberNickname]").on("blur", function () {
                var regex = /^[가-힣0-9]{2,10}$/;
                var valid = regex.test($(this).val());
                if (valid == false) {
                    $(this).removeClass("success fail fail2").addClass("fail");
                    state.memberNicknameValid = false;
                    return;
                }
                var memberNickname = $("[name=memberNickname]").val();
                $.ajax({
                    url: "http://localhost:8080/rest/member/checkMemberNickname?memberNickname=" + memberNickname,
                    method: "get",
                    success: function (response) {
                        //서버의 검사 결과에 따른 처리
                        //- 서버가 아이디가 사용중이라고 하면 fail2를 추가
                        //- 서버가 아이디가 사용중이 아니라고 하면 success를 추가
                        //console.log(response);
                        if (response == true) {//닉네임이 서버에 이미 존재하는 경우
                            $("[name=memberNickname]").removeClass("success fail fail2").addClass("fail2");
                            state.memberNicknameValid = false;
                        }
                        else {//닉네임이 서버에 존재하지 않는 경우
                            $("[name=memberNickname]").removeClass("success fail fail2").addClass("success");
                            state.memberNicknameValid = true;
                        }
                    }
                });
            });

            //이메일 관련
            $("[name=memberEmail]").on("blur", function () {
                var valid = $(this).val().length > 0;
                $(this).removeClass("success fail").addClass(valid ? "success" : "fail");
                state.memberEmailValid = valid;
            });

            //연락처 관련
            $("[name=memberContact]").on("blur", function () {
                var regex = /^010[1-9][0-9]{3}[0-9]{4}$/;
                //var regex = /^010-[1-9][0-9]{3}-[0-9]{4}$/;
                var valid = $(this).val().length == 0 || regex.test($(this).val());
                $(this).removeClass("success fail").addClass(valid ? "success" : "fail");
                state.memberContactValid = valid;
            });
            $("[name=memberContact]").on("input", function () {
                //[1] 숫자만 입력가능하게
                var replacement = $(this).val().replace(/[^0-9]/g, "");//숫자가 아닌 것을 제거
                replacement = replacement.substring(0, 11);//11글자가 넘는 부분을 제거
                $(this).val(replacement);

                //[2] 대시가 자동포함되도록
                // if(replacement.length <= 7) {//글자수가 7글자 이하라면(대시 1개)
                //     var regex = /^([0-9]{3})([0-9]{1,4})$/;
                //     replacement = replacement.replace(regex, "$1-$2");
                //     $(this).val(replacement);
                // }
                // else {//8글자 이상이라면(대시 2개)
                //     var regex = /^([0-9]{3})([0-9]{4})([0-9]{1,4})$/;
                //     replacement = replacement.replace(regex, "$1-$2-$3");
                //     $(this).val(replacement);
                // }
            });

            //생년월일 관련
            var picker1 = new Lightpick({
                field: document.querySelector(".picker-1")
            });
            var picker2 = new Lightpick({
                field: document.querySelector(".picker-2"),
                format: "YYYY-MM-DD",
            });
            var picker3 = new Lightpick({
                field: document.querySelector(".picker-3"),
                format: "YYYY-MM-DD",
                firstDay: 7,//일요일부터 시작
            });
            var picker4 = new Lightpick({
                field: document.querySelector(".picker-4"),
                format: "YYYY-MM-DD",
                firstDay: 7,
                maxDate: moment().subtract(1, 'day'),//오늘 이전
            });
            var picker5 = new Lightpick({
                field: document.querySelector(".picker-5"),
                format: "YYYY-MM-DD",
                firstDay: 7,
                minDate: moment(),//오늘부터
                // minDate: moment().add(1, 'day'),//내일부터
            });
            var picker6 = new Lightpick({
                field: document.querySelector(".picker-6"),
                format: "YYYY-MM-DD",//출력 형식 설정
                firstDay: 7,//일요일부터 시작
                disableDates: [//불가능한 날짜
                    "2025-12-25",//하루 지정
                    ["2025-10-03", "2025-10-12"],//범위 지정
                    //moment().add(1, "week").startOf("week").add(1, "day"),//다음주 월요일
                    moment().endOf("week").add(2, "day"),//다음주 월요일
                ],
            });
            var picker7 = new Lightpick({
                field: document.querySelector(".picker-7"),
                secondField: document.querySelector(".picker-8"),
                singleDate: false,
                format: "YYYY-MM-DD",
                firstDay: 7,
                numberOfMonths:2,//전체 표시될 월의 개수
                numberOfColumns:2,//한 줄에 표시될 월의 개수
                selectForward:true,//두번째 선택일은 첫번째 선택일보다 무조건 이후
                // selectBackward:true,//두번째 선택일은 첫번째 선택일보다 무조건 이전
                minDays:3,//선택 가능한 최소기간(일)
                maxDays:7,//선택 가능한 최대 기간(일)
            });
            
            //주소 관련
            //- 검색버튼, 우편번호입력창, 기본주소입력창을 클릭하면 다음 우편 API가 실행되어야 한다
            //- 상세주소입력창에 blur 이벤트가 발생하면 형식검사(모두 있거나 모두 없어야 통과)
            //- 내용이 작성되어 있는 경우에는 x버튼이 나와야 한다
            //- 우편 API를 실행하는 내용은 findAddress 라는 함수로 따로 분리하여 구현한다
            //- Daum 우편 API CDN이 필요
            function findAddress() {
                //daum에서 제공하는 샘플 코드
                new daum.Postcode({
                    oncomplete: function (data) {
                        // 팝업에서 검색결과 항목을 클릭했을때 실행할 코드를 작성하는 부분.

                        // 각 주소의 노출 규칙에 따라 주소를 조합한다.
                        // 내려오는 변수가 값이 없는 경우엔 공백('')값을 가지므로, 이를 참고하여 분기 한다.
                        var addr = ''; // 주소 변수

                        //사용자가 선택한 주소 타입에 따라 해당 주소 값을 가져온다.
                        if (data.userSelectedType === 'R') { // 사용자가 도로명 주소를 선택했을 경우
                            addr = data.roadAddress;
                        } else { // 사용자가 지번 주소를 선택했을 경우(J)
                            addr = data.jibunAddress;
                        }
                        $("[name=memberPost]").val(data.zonecode);
                        $("[name=memberAddress1]").val(addr);
                        $("[name=memberAddress2]").trigger("focus");

                        //삭제버튼 표시
                        $(".btn-address-clear").show();
                    }
                }).open();
            }
            $(".btn-address-search, [name=memberPost], [name=memberAddress1]").on("click", findAddress);
            $(".btn-address-clear").on("click", function () {
                //모든 입력창의 입력값을 지우고 삭제버튼 숨김 처리
                $("[name=memberPost], [name=memberAddress1], [name=memberAddress2]").val("");
                $(this).hide();
            });
            $("[name=memberAddress2]").on("blur", function () {
                var fill = $("[name=memberPost]").val().length > 0
                    && $("[name=memberAddress1]").val().length > 0
                    && $("[name=memberAddress2]").val().length > 0;
                var empty = $("[name=memberPost]").val().length == 0
                    && $("[name=memberAddress1]").val().length == 0
                    && $("[name=memberAddress2]").val().length == 0;
                var valid = fill || empty;
                $("[name=memberPost], [name=memberAddress1], [name=memberAddress2]")
                    .removeClass("success fail").addClass(valid ? "success" : "fail");

                state.memberAddressValid = valid;
            });

            //폼 검사
            $(".check-form").on("submit", function () {
                $(this).find("[name]").trigger("blur");
                return state.ok();
            });
        });
    </script>
</head>

<body>
    <form action="" method="" enctype="multipart/form-data" autocomplete="off" class="check-form">
        <div class="container w-600">

            <div class="cell center">
                <h1>가입 정보 입력</h1>
            </div>

            <!-- 아이디 -->
            <div class="cell">
                <label>아이디 <i class="fa-solid fa-asterisk red"></i></label>
                <input type="text" name="memberId" class="field w-100">
                <div class="success-feedback">멋진 아이디입니다!</div>
                <div class="fail-feedback">아이디는 알파벳 소문자로 시작하며 숫자를 포함해 8~20자로 작성하세요</div>
                <div class="fail2-feedback">아이디가 이미 사용중입니다</div>
            </div>

            <!-- 비밀번호-->
            <div class="cell">
                <label>
                    비밀번호
                    <i class="fa-solid fa-asterisk red"></i>
                    <i class="fa-solid fa-eye-slash" id="password-show"></i>
                </label>
                <input type="password" name="memberPw" class="field w-100">
                <div class="success-feedback">비밀번호가 올바른 형식입니다</div>
                <div class="fail-feedback">알파벳 대/소문자, 숫자, 특수문자를 반드시 포함하여 8 ~16자로 작성하세요</div>
            </div>

            <div class="cell">
                <label>비밀번호 확인 <i class="fa-solid fa-asterisk red"></i></label>
                <input type="password" id="password-check" class="field w-100">
                <div class="success-feedback">비밀번호가 일치합니다</div>
                <div class="fail-feedback">비밀번호가 일치하지 않습니다</div>
            </div>

            <!-- 닉네임 -->
            <div class="cell">
                <label>닉네임 <i class="fa-solid fa-asterisk red"></i></label>
                <input type="text" name="memberNickname" class="field w-100">
                <div class="success-feedback">멋진 닉네임입니다!</div>
                <div class="fail-feedback">한글 또는 숫자 2~10글자로 작성하세요</div>
                <div class="fail2-feedback">닉네임이 이미 사용중입니다</div>
            </div>

            <!-- 이메일 -->
            <div class="cell">
                <label>이메일 <i class="fa-solid fa-asterisk red"></i></label>
                <input type="text" inputmode="email" name="memberEmail" class="field w-100">
                <!-- <div class="success-feedback">이메일 인증이 완료되었습니다</div> -->
                <div class="fail-feedback">필수 항목입니다</div>
            </div>

            <!-- 연락처 -->
            <div class="cell">
                <label>연락처</label>
                <input type="text" inputmode="tel" name="memberContact" class="field w-100">
                <div class="fail-feedback">010으로 시작하는 11자리 휴대전화번호를 입력하세요 (- 사용 불가)</div>
            </div>

            <!-- 생년월일 -->
            <div class="cell">
                <label>생년월일</label>
                <input type="text" name="memberBirth" class="field w-100 picker-1">
            </div>
            <div class="cell mt-20">
                <label>날짜형식변경</label>
                <input type="text" name="memberBirth" class="field w-100 picker-2">
            </div>
            <div class="cell mt-20">
                <label>요일형식변경</label>
                <input type="text" name="memberBirth" class="field w-100 picker-3">
            </div>
            <div class="cell mt-20">
                <label>과거날짜만 선택가능</label>
                <input type="text" name="memberBirth" class="field w-100 picker-4">
            </div>
            <div class="cell mt-20">
                <label>미래날짜만 선택가능</label>
                <input type="text" name="memberBirth" class="field w-100 picker-5">
            </div>
            <div class="cell mt-20">
                <label>특정날짜 선택불가능</label>
                <input type="text" name="memberBirth" class="field w-100 picker-6">
            </div>
            <div class="cell mt-20">
                <label>기간 선택</label>
                <div class="flex-box">
                    <input type="text" name="memberBirth" class="field w-100 picker-7">
                    <span style="font-size: 24px;" class="ms-10 me-10 flex-box flex-center">~</span>
                    <input type="text" name="memberBirth" class="field w-100 picker-8">
                </div>
            </div>

            <!-- 주소 -->
            <div class="cell">
                주소
            </div>
            <div class="cell">
                <input type="text" name="memberPost" placeholder="우편번호" size="6" class="field" inputmode="numeric"
                    readonly>
                <button type="button" class="btn btn-neutral btn-address-search">
                    <i class="fa-solid fa-magnifying-glass"></i>
                </button>
                <button type="button" class="btn btn-negative btn-address-clear" style="display: none;">
                    <i class="fa-solid fa-xmark"></i>
                </button>
            </div>
            <div class="cell">
                <input type="text" name="memberAddress1" placeholder="기본주소" class="field w-100" readonly>
            </div>
            <div class="cell">
                <input type="text" name="memberAddress2" placeholder="상세주소" class="field w-100">
                <div class="fail-feedback">주소는 모두 작성해야 합니다</div>
            </div>

            <!-- 프로필 선택 -->
            <div class="cell">
                <label>프로필 이미지</label>
                <input type="file" name="attach" class="field w-100">
            </div>
            <!-- 미리보기 -->
            <div class="cell"></div>

            <!-- 가입버튼 -->
            <div class="cell mt-40">
                <button type="submit" class="btn btn-positive w-100">
                    <i class="fa-solid right-to-bracket"></i>
                    <span>회원 가입</span>
                </button>
            </div>

        </div>
    </form>
</body>

</html>
